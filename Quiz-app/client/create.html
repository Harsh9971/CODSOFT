<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Quiz</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>

<div class="container">

    <h2>Create Quiz</h2>

    <!-- Renamed id to avoid conflict with document.title -->
    <input id="quizTitle" placeholder="Quiz Title">

    <h3>Add Question</h3>

    <input id="qText" placeholder="Enter Question">

    <input id="opt1" placeholder="Option 1">
    <input id="opt2" placeholder="Option 2">
    <input id="opt3" placeholder="Option 3">
    <input id="opt4" placeholder="Option 4">

    <select id="correct">
        <option value="">Correct Answer</option>
        <option value="0">Option 1</option>
        <option value="1">Option 2</option>
        <option value="2">Option 3</option>
        <option value="3">Option 4</option>
    </select>

    <!-- ensure buttons are plain buttons (not form submit) -->
    <button type="button" id="addBtn">Add Question</button>

    <hr>

    <h3>Questions Added:</h3>
    <ul id="questionList"></ul>

    <button type="button" id="saveBtn">Save Quiz</button>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    let questions = [];

    const qTitleEl = document.getElementById("quizTitle");
    const qTextEl = document.getElementById("qText");
    const opt1El = document.getElementById("opt1");
    const opt2El = document.getElementById("opt2");
    const opt3El = document.getElementById("opt3");
    const opt4El = document.getElementById("opt4");
    const correctEl = document.getElementById("correct");
    const listEl = document.getElementById("questionList");
    const addBtn = document.getElementById("addBtn");
    const saveBtn = document.getElementById("saveBtn");

    // Add question
    addBtn.addEventListener("click", () => {
        const q = qTextEl.value.trim();
        const o1 = opt1El.value.trim();
        const o2 = opt2El.value.trim();
        const o3 = opt3El.value.trim();
        const o4 = opt4El.value.trim();
        const c = correctEl.value;

        if (!q || !o1 || !o2 || !o3 || !o4 || c === "") {
            alert("Please fill all fields before adding a question.");
            return;
        }

        const questionObj = {
            question: q,
            options: [o1, o2, o3, o4],
            correctAnswer: Number(c)
        };

        questions.push(questionObj);

        // Add to list visually
        const li = document.createElement("li");
        li.textContent = q;
        listEl.appendChild(li);

        // Clear fields
        qTextEl.value = "";
        opt1El.value = "";
        opt2El.value = "";
        opt3El.value = "";
        opt4El.value = "";
        correctEl.value = "";

        alert("Question Added!");
    });

    // Save quiz to server
    saveBtn.addEventListener("click", async () => {
        const title = qTitleEl.value.trim();

        if (!title) {
            alert("Please enter quiz title!");
            return;
        }
        if (questions.length === 0) {
            alert("Please add at least one question!");
            return;
        }

        // disable save to prevent double-submits
        saveBtn.disabled = true;
        saveBtn.textContent = "Saving...";

        try {
            const res = await fetch("http://localhost:5000/quiz/create", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    title,
                    questions
                })
            });

            if (!res.ok) {
                const text = await res.text().catch(() => null);
                throw new Error("Server error: " + (text || res.status));
            }

            alert("Quiz Saved Successfully!");
            // optional: clear everything
            qTitleEl.value = "";
            listEl.innerHTML = "";
            questions = [];
            window.location.href = "index.html";
        } catch (err) {
            console.error("Error saving quiz:", err);
            alert("Failed to save quiz. Check your server and console for details.");
        } finally {
            saveBtn.disabled = false;
            saveBtn.textContent = "Save Quiz";
        }
    });
});
</script>

</body>
</html>


